{% extends "base.html" %}

{% block content %}
<div id="mainContent">
    <div class="container-fluid">
        <div class="row">
            <!-- Left Sidebar -->
            <div class="col-md-3 col-lg-2">
                <div class="create-sidebar">
                    <div class="sidebar-section">
                        <h6 class="sidebar-title">
                            <i class="fas fa-lightbulb me-2"></i>Create
                        </h6>
                        <ul class="sidebar-menu">
                            <li class="sidebar-item" onclick="showSection('ideas')">
                                <i class="fas fa-lightbulb"></i>
                                <span>Ideas</span>
                            </li>
                            <li class="sidebar-item active" onclick="showSection('templates')">
                                <i class="fas fa-layer-group"></i>
                                <span>Templates</span>
                                <span class="badge-new">New</span>
                            </li>
                        </ul>
                    </div>

                    <div class="sidebar-section">
                        <h6 class="sidebar-title">
                            <i class="fas fa-rss me-2"></i>Feeds
                        </h6>
                        <button class="btn btn-outline-primary btn-sm w-100 mb-2">
                            <i class="fas fa-plus"></i>
                        </button>
                        <p class="small text-muted">
                            Add feeds from your favorite websites to get content ideas
                        </p>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-md-9 col-lg-10">
                <div class="main-content-area">
                    <!-- Ideas Section -->
                    <div id="ideas-content" style="display: none;">
                        <div class="ideas-header mb-4">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h2 class="mb-0 d-flex align-items-center">
                                        <span>Ideas</span>
                                        <button class="btn btn-outline-primary btn-sm ms-3">
                                            <i class="fas fa-magic me-1"></i>Generate Ideas
                                        </button>
                                    </h2>
                                </div>
                                <div class="col-md-6">
                                    <div class="header-actions d-flex justify-content-end gap-2">
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-share me-2"></i>Share Feedback
                    </button>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-tags me-2"></i>Tags
                    </button>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-th me-2"></i>Board
                    </button>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-th-large me-2"></i>Gallery
                    </button>
                    <button class="btn btn-primary">
                                            <i class="fas fa-plus me-2"></i>New Idea
                    </button>
                                    </div>
                </div>
            </div>
        </div>

        <!-- Kanban Board -->
        <div class="kanban-board">
                            <div class="kanban-column">
                <div class="column-header">
                                    <h5>Unassigned <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                                <div class="column-content" data-status="unassigned">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('unassigned')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                        </div>
                        </div>
                    </div>
                    
                            <div class="kanban-column">
                                <div class="column-header">
                                    <h5>To Do <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                                        <i class="fas fa-plus"></i>
                            </button>
                        </div>
                                <div class="column-content" data-status="todo">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('todo')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                    </div>
                </div>
            </div>

                            <div class="kanban-column">
                <div class="column-header">
                                    <h5>In Progress <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                                <div class="column-content" data-status="inprogress">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('inprogress')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                </div>
                </div>
            </div>

                            <div class="kanban-column">
                <div class="column-header">
                                    <h5>Done <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                                <div class="column-content" data-status="done">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('done')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                                    </div>
                                </div>
                </div>
                </div>
            </div>

                    <!-- Templates Section -->
                    <div id="templates-content">
                        <!-- Include the templates content here -->
                        <div class="templates-header mb-5">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h2 class="mb-0" style="color: var(--buffer-text-primary); font-weight: 700;">Templates</h2>
                                    <p class="mb-0 mt-2" style="color: var(--buffer-text-secondary);">Ready-to-use content templates for your YouTube channel</p>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-outline-primary">
                                        <i class="fas fa-share me-2"></i>Share Feedback
                    </button>
                </div>
                            </div>
                        </div>

                        <!-- Template Categories -->
                        <div class="template-categories mb-5">
                            <div class="d-flex flex-wrap justify-content-center justify-content-md-start gap-2">
                                <button class="category-btn active" data-category="all">All</button>
                                <button class="category-btn" data-category="tip">Tip</button>
                                <button class="category-btn" data-category="case-study">Case Study</button>
                                <button class="category-btn" data-category="story">Story</button>
                                <button class="category-btn" data-category="how-to">How-to</button>
                                <button class="category-btn" data-category="question">Question</button>
                                <button class="category-btn" data-category="opinion">Opinion</button>
                                <button class="category-btn" data-category="list">List</button>
                                <button class="category-btn" data-category="behind-scenes">Behind the scenes</button>
                                <button class="category-btn" data-category="more">More <i class="fas fa-chevron-down ms-1"></i></button>
                            </div>
                </div>

                        <!-- Templates Grid -->
                        <div class="row g-4">
                            <div class="col-lg-4 col-md-6">
                                <div class="template-card h-100" data-category="how-to">
                                    <div class="template-icon">üåô</div>
                                    <h4>Walk through your midday reset ritual</h4>
                                    <p>Walk your audience through the small habits or actions that help you reset and refocus halfway through the day.</p>
                                    <div class="template-actions mt-auto">
                                        <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                </div>
            </div>
        </div>

                            <div class="col-lg-4 col-md-6">
                                <div class="template-card h-100" data-category="story">
                                    <div class="template-icon">üåô</div>
                                    <h4>Share how you wind down at night</h4>
                                    <p>Show your audience how you disconnect, reflect, or prep for the next day.</p>
                                    <div class="template-actions mt-auto">
                                        <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                                    </div>
                                </div>
            </div>

                            <div class="col-lg-4 col-md-6">
                                <div class="template-card h-100" data-category="how-to">
                                    <div class="template-icon">‚òÄÔ∏è</div>
                                    <h4>Share how you optimize your morning workflow</h4>
                                    <p>Walk your audience through a personal morning routine or work setup that boosts productivity.</p>
                                    <div class="template-actions mt-auto">
                                        <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                                    </div>
                                </div>
            </div>

                            <div class="col-lg-4 col-md-6">
                                <div class="template-card h-100" data-category="story">
                                    <div class="template-icon">‚úçÔ∏è</div>
                                    <h4>Introduce (or reintroduce) yourself</h4>
                                    <p>Tell your audience who you are, what you create content about, and who it's for.</p>
                                    <div class="template-badge">New</div>
                                    <div class="template-actions mt-auto">
                                        <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                                    </div>
                                </div>
            </div>

                            <div class="col-lg-4 col-md-6">
                                <div class="template-card h-100" data-category="story">
                                    <div class="template-icon">üí°</div>
                                    <h4>One habit I swear by ‚Äî and one I'm quitting</h4>
                                    <p>Share a personal contrast and invite your audience to do the same.</p>
                                    <div class="template-actions mt-auto">
                                        <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                                    </div>
                                </div>
            </div>

                            <div class="col-lg-4 col-md-6">
                                <div class="template-card h-100" data-category="list">
                                    <div class="template-icon">üì∞</div>
                                    <h4>5 newsletters I never miss</h4>
                                    <p>Curate a list of high-value newsletters for your niche ‚Äî and share why they're worth it.</p>
                                    <div class="template-actions mt-auto">
                                        <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
            </div>
        </div>
    </div>
</div>
                    </div>
            </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show navigation for logged in users
    showNavbar();
    
    // Set active nav link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.href.includes('/create')) {
            link.classList.add('active');
        }
    });
    
    // Initialize category filtering
    initializeCategoryFiltering();
    
    // Show templates by default
    showSection('templates');
    
    // Load saved ideas
    loadIdeas();
});

function initializeCategoryFiltering() {
    const categoryBtns = document.querySelectorAll('.category-btn');
    const templateCards = document.querySelectorAll('.template-card');
    
    categoryBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Update active button
            categoryBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const category = this.dataset.category;
            
            // Filter templates
            templateCards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });
}

function showSection(section) {
    // Update sidebar active state
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Hide all sections
    document.getElementById('ideas-content').style.display = 'none';
    document.getElementById('templates-content').style.display = 'none';
    
    // Show selected section
    if (section === 'ideas') {
        document.getElementById('ideas-content').style.display = 'block';
        document.querySelector('.sidebar-item[onclick="showSection(\'ideas\')"]').classList.add('active');
    } else {
        document.getElementById('templates-content').style.display = 'block';
        document.querySelector('.sidebar-item[onclick="showSection(\'templates\')"]').classList.add('active');
    }
}

function addNewIdea(status) {
    const title = prompt('Enter idea title:');
    if (!title) return;
    
    const description = prompt('Enter idea description (optional):') || '';
    
    const idea = {
        id: Date.now(),
        title: title,
        description: description,
        status: status,
        timestamp: new Date().toISOString()
    };
    
    // Save to localStorage
    let ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    ideas.push(idea);
    localStorage.setItem('ideas', JSON.stringify(ideas));
    
    // Refresh the board
    loadIdeas();
}

function loadIdeas() {
    const ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    
    // Clear all columns
    document.querySelectorAll('.column-content').forEach(column => {
        const placeholder = column.querySelector('.add-idea-placeholder');
        column.innerHTML = '';
        column.appendChild(placeholder);
    });
    
    // Group ideas by status
    const groupedIdeas = {
        unassigned: [],
        todo: [],
        inprogress: [],
        done: []
    };
    
    ideas.forEach(idea => {
        if (groupedIdeas[idea.status]) {
            groupedIdeas[idea.status].push(idea);
        }
    });
    
    // Add ideas to columns
    Object.keys(groupedIdeas).forEach(status => {
        const column = document.querySelector(`[data-status="${status}"]`);
        const placeholder = column.querySelector('.add-idea-placeholder');
        
        groupedIdeas[status].forEach(idea => {
            const ideaCard = createIdeaCard(idea);
            column.insertBefore(ideaCard, placeholder);
        });
        
        // Update count
        const countSpan = column.parentElement.querySelector('.count');
        countSpan.textContent = groupedIdeas[status].length;
    });
}

function createIdeaCard(idea) {
    const card = document.createElement('div');
    card.className = 'idea-card';
    card.draggable = true;
    card.dataset.ideaId = idea.id;
    
    card.innerHTML = `
        <h6>${idea.title}</h6>
        ${idea.description ? `<p>${idea.description}</p>` : ''}
        <div class="idea-actions">
            <button class="btn btn-sm btn-outline-primary" onclick="editIdea(${idea.id})">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteIdea(${idea.id})">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    return card;
}

function editIdea(ideaId) {
    const ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    const idea = ideas.find(i => i.id === ideaId);
    if (!idea) return;
    
    const newTitle = prompt('Edit title:', idea.title);
    if (newTitle === null) return;
    
    const newDescription = prompt('Edit description:', idea.description || '');
    if (newDescription === null) return;
    
    idea.title = newTitle;
    idea.description = newDescription;
    
    localStorage.setItem('ideas', JSON.stringify(ideas));
    loadIdeas();
}

function deleteIdea(ideaId) {
    if (!confirm('Delete this idea?')) return;
    
    let ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    ideas = ideas.filter(i => i.id !== ideaId);
    
    localStorage.setItem('ideas', JSON.stringify(ideas));
    loadIdeas();
}

function useTemplate(button) {
    const card = button.closest('.template-card');
    const title = card.querySelector('h4').textContent;
    const description = card.querySelector('p').textContent;
    
    // Add template as an idea
    const idea = {
        id: Date.now(),
        title: title,
        description: description,
        status: 'unassigned',
        timestamp: new Date().toISOString()
    };
    
    let ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    ideas.push(idea);
    localStorage.setItem('ideas', JSON.stringify(ideas));
    
    // Switch to ideas view
    showSection('ideas');
    loadIdeas();
    
    alert('Template added to Ideas!');
}
</script>
{% endblock %}