{% extends "base.html" %}

{% block content %}
<div id="mainContent">
    <div class="container">
        <!-- Header Section -->
        <div class="create-header mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2>Ideas <i class="fas fa-magic" style="color: var(--buffer-primary); margin-left: 0.5rem;"></i> Generate Ideas</h2>
                </div>
                <div class="create-actions">
                    <button class="btn btn-outline-primary">
                        <i class="fas fa-share"></i> Share Feedback
                    </button>
                    <button class="btn btn-outline-primary">
                        <i class="fas fa-tags"></i> Tags
                    </button>
                    <button class="btn btn-outline-primary">
                        <i class="fas fa-th"></i> Board
                    </button>
                    <button class="btn btn-outline-primary">
                        <i class="fas fa-th-large"></i> Gallery
                    </button>
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i> New Idea
                    </button>
                </div>
            </div>
        </div>

        <!-- Kanban Board -->
        <div class="kanban-board">
            <div class="kanban-column" data-status="unassigned">
                <div class="column-header">
                    <h5>Unassigned <span class="count" id="unassigned-count">2</span></h5>
                    <button class="btn btn-sm btn-outline-primary add-item-btn" onclick="addNewIdea('unassigned')">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="column-content" id="unassigned-column">
                    <!-- Sample Ideas -->
                    <div class="idea-card" draggable="true" data-id="1">
                        <div class="idea-content">
                            <h6>This is a place to plan üí° your content</h6>
                            <p>Save your ideas before converting them into posts. Brainstorm, plan ahead, and refine! To find out more...</p>
                        </div>
                        <div class="idea-actions">
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="idea-card" draggable="true" data-id="2">
                        <div class="idea-content">
                            <h6>Save inspirations you find online with one click üòç</h6>
                            <p>Use üîµ Buffer browser extension to save ideas from the Web. Highlight text or select an image and right click...</p>
                        </div>
                        <div class="idea-actions">
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="add-idea-placeholder" onclick="addNewIdea('unassigned')">
                    <i class="fas fa-plus"></i> New Idea
                </div>
            </div>

            <div class="kanban-column" data-status="todo">
                <div class="column-header">
                    <h5>To Do <span class="count" id="todo-count">0</span></h5>
                    <button class="btn btn-sm btn-outline-primary add-item-btn" onclick="addNewIdea('todo')">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="column-content" id="todo-column">
                    <!-- Ideas will be added here -->
                </div>
                <div class="add-idea-placeholder" onclick="addNewIdea('todo')">
                    <i class="fas fa-plus"></i> New Idea
                </div>
            </div>

            <div class="kanban-column" data-status="progress">
                <div class="column-header">
                    <h5>In Progress <span class="count" id="progress-count">0</span></h5>
                    <button class="btn btn-sm btn-outline-primary add-item-btn" onclick="addNewIdea('progress')">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="column-content" id="progress-column">
                    <!-- Ideas will be added here -->
                </div>
                <div class="add-idea-placeholder" onclick="addNewIdea('progress')">
                    <i class="fas fa-plus"></i> New Idea
                </div>
            </div>

            <div class="kanban-column" data-status="done">
                <div class="column-header">
                    <h5>Done <span class="count" id="done-count">0</span></h5>
                    <button class="btn btn-sm btn-outline-primary add-item-btn" onclick="addNewIdea('done')">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="column-content" id="done-column">
                    <!-- Completed ideas will be added here -->
                </div>
                <div class="add-idea-placeholder" onclick="addNewIdea('done')">
                    <i class="fas fa-plus"></i> New Idea
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="create-sidebar">
            <div class="sidebar-section">
                <h6><i class="fas fa-lightbulb me-2"></i>Ideas</h6>
                <ul class="sidebar-menu">
                    <li class="active">
                        <i class="fas fa-lightbulb"></i> Ideas
                        <span class="badge">2</span>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h6><i class="fas fa-layer-group me-2"></i>Templates</h6>
                <div class="template-badge">New</div>
                <ul class="sidebar-menu">
                    <li>
                        <i class="fas fa-layer-group"></i> Templates
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h6><i class="fas fa-rss me-2"></i>Feeds</h6>
                <button class="btn btn-sm btn-outline-primary w-100">
                    <i class="fas fa-plus"></i>
                </button>
                <p class="small text-muted mt-2">
                    Add feeds from your favorite websites to get content ideas
                </p>
            </div>

            <div class="sidebar-section">
                <h6><i class="fas fa-cog me-2"></i>Manage Tags</h6>
            </div>

            <div class="sidebar-section">
                <h6><i class="fas fa-users me-2"></i>Manage Channels</h6>
            </div>
        </div>
    </div>
</div>

<!-- New Idea Modal -->
<div class="modal fade" id="newIdeaModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">New Idea</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="ideaForm">
                    <div class="mb-3">
                        <label for="ideaTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="ideaTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="ideaDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="ideaDescription" rows="3"></textarea>
                    </div>
                    <input type="hidden" id="ideaStatus" value="">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveIdea()">Save Idea</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show navigation for logged in users
    showNavbar();
    
    // Set active nav link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.href.includes('/create')) {
            link.classList.add('active');
        }
    });
    
    // Initialize drag and drop
    initializeDragAndDrop();
    
    // Update counts
    updateCounts();
});

let draggedElement = null;
let ideaCounter = 3;

function initializeDragAndDrop() {
    const cards = document.querySelectorAll('.idea-card');
    const columns = document.querySelectorAll('.column-content');
    
    // Add drag listeners to cards
    cards.forEach(card => {
        card.addEventListener('dragstart', handleDragStart);
        card.addEventListener('dragend', handleDragEnd);
    });
    
    // Add drop listeners to columns
    columns.forEach(column => {
        column.addEventListener('dragover', handleDragOver);
        column.addEventListener('drop', handleDrop);
        column.addEventListener('dragenter', handleDragEnter);
        column.addEventListener('dragleave', handleDragLeave);
    });
}

function handleDragStart(e) {
    draggedElement = this;
    this.style.opacity = '0.5';
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/html', this.outerHTML);
}

function handleDragEnd(e) {
    this.style.opacity = '1';
    draggedElement = null;
}

function handleDragOver(e) {
    if (e.preventDefault) {
        e.preventDefault();
    }
    e.dataTransfer.dropEffect = 'move';
    return false;
}

function handleDragEnter(e) {
    this.classList.add('drag-over');
}

function handleDragLeave(e) {
    this.classList.remove('drag-over');
}

function handleDrop(e) {
    if (e.stopPropagation) {
        e.stopPropagation();
    }
    
    this.classList.remove('drag-over');
    
    if (draggedElement !== null) {
        // Remove the dragged element from its original position
        draggedElement.remove();
        
        // Add to new column
        this.appendChild(draggedElement);
        
        // Re-initialize drag and drop for the moved element
        draggedElement.addEventListener('dragstart', handleDragStart);
        draggedElement.addEventListener('dragend', handleDragEnd);
        
        // Update counts
        updateCounts();
    }
    
    return false;
}

function addNewIdea(status) {
    document.getElementById('ideaStatus').value = status;
    const modal = new bootstrap.Modal(document.getElementById('newIdeaModal'));
    modal.show();
}

function saveIdea() {
    const title = document.getElementById('ideaTitle').value;
    const description = document.getElementById('ideaDescription').value;
    const status = document.getElementById('ideaStatus').value;
    
    if (!title.trim()) {
        alert('Please enter a title for your idea');
        return;
    }
    
    const ideaCard = document.createElement('div');
    ideaCard.className = 'idea-card';
    ideaCard.draggable = true;
    ideaCard.dataset.id = ideaCounter++;
    
    ideaCard.innerHTML = `
        <div class="idea-content">
            <h6>${title}</h6>
            <p>${description || 'No description provided'}</p>
        </div>
        <div class="idea-actions">
            <button class="btn btn-sm btn-outline-primary" onclick="editIdea(this)">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteIdea(this)">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    // Add event listeners
    ideaCard.addEventListener('dragstart', handleDragStart);
    ideaCard.addEventListener('dragend', handleDragEnd);
    
    // Add to appropriate column
    document.getElementById(status + '-column').appendChild(ideaCard);
    
    // Clear form and close modal
    document.getElementById('ideaForm').reset();
    bootstrap.Modal.getInstance(document.getElementById('newIdeaModal')).hide();
    
    // Update counts
    updateCounts();
}

function editIdea(button) {
    const card = button.closest('.idea-card');
    const title = card.querySelector('h6').textContent;
    const description = card.querySelector('p').textContent;
    
    document.getElementById('ideaTitle').value = title;
    document.getElementById('ideaDescription').value = description === 'No description provided' ? '' : description;
    
    // Remove the old card
    card.remove();
    updateCounts();
    
    const modal = new bootstrap.Modal(document.getElementById('newIdeaModal'));
    modal.show();
}

function deleteIdea(button) {
    if (confirm('Are you sure you want to delete this idea?')) {
        button.closest('.idea-card').remove();
        updateCounts();
    }
}

function updateCounts() {
    const columns = ['unassigned', 'todo', 'progress', 'done'];
    
    columns.forEach(column => {
        const count = document.getElementById(column + '-column').children.length;
        document.getElementById(column + '-count').textContent = count;
    });
    
    // Update sidebar count
    const totalIdeas = columns.reduce((total, column) => {
        return total + document.getElementById(column + '-column').children.length;
    }, 0);
    
    const sidebarBadge = document.querySelector('.sidebar-menu .badge');
    if (sidebarBadge) {
        sidebarBadge.textContent = totalIdeas;
    }
}
</script>
{% endblock %}
