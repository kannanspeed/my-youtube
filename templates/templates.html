{% extends "base.html" %}

{% block content %}
<div id="mainContent">
    <div class="container-fluid">
        <div class="row">
            <!-- Left Sidebar -->
            <div class="col-md-3 col-lg-2">
                <div class="create-sidebar">
                    <div class="sidebar-section">
                        <h6 class="sidebar-title">
                            <i class="fas fa-lightbulb me-2"></i>Create
                        </h6>
                        <ul class="sidebar-menu">
                            <li class="sidebar-item" onclick="showSection('ideas')">
                                <i class="fas fa-lightbulb"></i>
                                <span>Ideas</span>
                            </li>
                            <li class="sidebar-item active" onclick="showSection('templates')">
                                <i class="fas fa-layer-group"></i>
                                <span>Templates</span>
                                <span class="badge-new">New</span>
                            </li>
                        </ul>
                    </div>

                    <div class="sidebar-section">
                        <h6 class="sidebar-title">
                            <i class="fas fa-rss me-2"></i>Feeds
                        </h6>
                        <button class="btn btn-outline-primary btn-sm w-100 mb-2">
                            <i class="fas fa-plus"></i>
                        </button>
                        <p class="small text-muted">
                            Add feeds from your favorite websites to get content ideas
                        </p>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-md-9 col-lg-10">
                <div class="main-content-area">
                    <!-- Ideas Section -->
                    <div id="ideas-content" style="display: none;">
                        <div class="ideas-header mb-4">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h2 class="mb-0 d-flex align-items-center">
                                        <span>Ideas</span>
                                        <button class="btn btn-outline-primary btn-sm ms-3">
                                            <i class="fas fa-magic me-1"></i>Generate Ideas
                                        </button>
                                    </h2>
                                </div>
                                <div class="col-md-6">
                                    <div class="header-actions d-flex justify-content-end gap-2">
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-share me-2"></i>Share Feedback
                                        </button>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-tags me-2"></i>Tags
                                        </button>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-th me-2"></i>Board
                                        </button>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-th-large me-2"></i>Gallery
                                        </button>
                                        <button class="btn btn-primary">
                                            <i class="fas fa-plus me-2"></i>New Idea
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Kanban Board -->
                        <div class="kanban-board">
                            <div class="kanban-column">
                                <div class="column-header">
                                    <h5>Unassigned <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="column-content" data-status="unassigned">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('unassigned')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                                    </div>
                                </div>
                            </div>

                            <div class="kanban-column">
                                <div class="column-header">
                                    <h5>To Do <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="column-content" data-status="todo">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('todo')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                                    </div>
                                </div>
                            </div>

                            <div class="kanban-column">
                                <div class="column-header">
                                    <h5>In Progress <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="column-content" data-status="inprogress">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('inprogress')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                                    </div>
                                </div>
                            </div>

                            <div class="kanban-column">
                                <div class="column-header">
                                    <h5>Done <span class="count">0</span></h5>
                                    <button class="btn btn-sm btn-outline-primary add-item-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="column-content" data-status="done">
                                    <div class="add-idea-placeholder" onclick="addNewIdea('done')">
                                        <i class="fas fa-plus me-2"></i>New Idea
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Templates Section -->
                    <div id="templates-content">
        <!-- Header Section -->
                        <div class="templates-header mb-5">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h2 class="mb-0" style="color: var(--buffer-text-primary); font-weight: 700;">Templates</h2>
                                    <p class="mb-0 mt-2" style="color: var(--buffer-text-secondary);">Ready-to-use content templates for your YouTube channel</p>
                </div>
                                <div class="col-md-4 text-end">
                    <button class="btn btn-outline-primary">
                                        <i class="fas fa-share me-2"></i>Share Feedback
                    </button>
                </div>
            </div>
        </div>

        <!-- Template Categories -->
        <div class="template-categories mb-5">
            <div class="d-flex flex-wrap justify-content-center justify-content-md-start gap-2">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="tip">Tip</button>
            <button class="category-btn" data-category="case-study">Case Study</button>
            <button class="category-btn" data-category="story">Story</button>
            <button class="category-btn" data-category="how-to">How-to</button>
            <button class="category-btn" data-category="question">Question</button>
            <button class="category-btn" data-category="opinion">Opinion</button>
            <button class="category-btn" data-category="list">List</button>
            <button class="category-btn" data-category="behind-scenes">Behind the scenes</button>
                <button class="category-btn" data-category="more">More <i class="fas fa-chevron-down ms-1"></i></button>
            </div>
        </div>

        <!-- Templates Grid -->
        <div class="row g-4">
            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="how-to">
                <div class="template-icon">üåô</div>
                <h4>Walk through your midday reset ritual</h4>
                <p>Walk your audience through the small habits or actions that help you reset and refocus halfway through the day.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="story">
                <div class="template-icon">üåô</div>
                <h4>Share how you wind down at night</h4>
                <p>Show your audience how you disconnect, reflect, or prep for the next day.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="how-to">
                <div class="template-icon">‚òÄÔ∏è</div>
                <h4>Share how you optimize your morning workflow</h4>
                <p>Walk your audience through a personal morning routine or work setup that boosts productivity.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="story">
                <div class="template-icon">‚úçÔ∏è</div>
                <h4>Introduce (or reintroduce) yourself</h4>
                <p>Tell your audience who you are, what you create content about, and who it's for.</p>
                <div class="template-badge">New</div>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="story">
                <div class="template-icon">üí°</div>
                <h4>One habit I swear by ‚Äî and one I'm quitting</h4>
                <p>Share a personal contrast and invite your audience to do the same.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="list">
                <div class="template-icon">üì∞</div>
                <h4>5 newsletters I never miss</h4>
                <p>Curate a list of high-value newsletters for your niche ‚Äî and share why they're worth it.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="tip">
                <div class="template-icon">ü§´</div>
                <h4>This feature is slept on</h4>
                <p>Highlight an underrated feature of your product or offer that consistently delivers results.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="question">
                <div class="template-icon">üî•</div>
                <h4>What's your unpopular opinion about [industry/topic]?</h4>
                <p>Invite bold responses and challenge the status quo.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="behind-scenes">
                <div class="template-icon">üéØ</div>
                <h4>Behind the scenes of my content creation</h4>
                <p>Show your process, tools, and workspace to build connection with your audience.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="case-study">
                <div class="template-icon">üìä</div>
                <h4>My biggest content marketing win</h4>
                <p>Share a success story and the lessons learned from your content marketing efforts.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="tip">
                <div class="template-icon">‚ö°</div>
                <h4>Quick tip for [specific problem]</h4>
                <p>Share a actionable tip that solves a common problem your audience faces.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="template-card h-100" data-category="opinion">
                <div class="template-icon">üé≠</div>
                <h4>Why I changed my mind about [topic]</h4>
                <p>Share how your perspective evolved and what influenced the change.</p>
                    <div class="template-actions mt-auto">
                    <button class="btn btn-outline-primary btn-sm" onclick="useTemplate(this)">Use Template</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coming Soon Section -->
        <div class="coming-soon-section mt-5">
            <div class="row">
                <div class="col-md-12">
                    <h3 class="mb-4">More Platforms Coming Soon</h3>
                    <div class="platform-cards">
                        <div class="platform-card coming-soon">
                            <i class="fab fa-instagram"></i>
                            <h5>Instagram Templates</h5>
                            <p>Story templates, post ideas, and engagement strategies</p>
                            <div class="coming-soon-badge">Coming Soon</div>
                        </div>
                        
                        <div class="platform-card coming-soon">
                            <i class="fab fa-facebook"></i>
                            <h5>Facebook Templates</h5>
                            <p>Page post templates and community engagement ideas</p>
                            <div class="coming-soon-badge">Coming Soon</div>
                        </div>
                        
                        <div class="platform-card coming-soon">
                            <i class="fab fa-twitter"></i>
                            <h5>Twitter Templates</h5>
                            <p>Thread templates, tweet ideas, and viral content formats</p>
                            <div class="coming-soon-badge">Coming Soon</div>
                        </div>
                        
                        <div class="platform-card coming-soon">
                            <i class="fab fa-linkedin"></i>
                            <h5>LinkedIn Templates</h5>
                            <p>Professional post templates and thought leadership content</p>
                            <div class="coming-soon-badge">Coming Soon</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                    </div>
            </div>
            </div>
        </div>
    </div>
</div>

<!-- Template Usage Modal -->
<div class="modal fade" id="templateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Use Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="template-preview">
                    <h4 id="templateTitle"></h4>
                    <p id="templateDescription"></p>
                </div>
                <div class="template-form mt-4">
                    <div class="mb-3">
                        <label class="form-label">Customize your content:</label>
                        <textarea class="form-control" id="templateContent" rows="5" placeholder="Customize this template for your audience..."></textarea>
                    </div>
                    <div class="platform-selection">
                        <label class="form-label">Select Platform:</label>
                        <div class="platform-options">
                            <div class="platform-option active">
                                <i class="fab fa-youtube"></i>
                                <span>YouTube</span>
                            </div>
                            <div class="platform-option disabled">
                                <i class="fab fa-instagram"></i>
                                <span>Instagram</span>
                                <small>Coming Soon</small>
                            </div>
                            <div class="platform-option disabled">
                                <i class="fab fa-facebook"></i>
                                <span>Facebook</span>
                                <small>Coming Soon</small>
                            </div>
                            <div class="platform-option disabled">
                                <i class="fab fa-twitter"></i>
                                <span>Twitter</span>
                                <small>Coming Soon</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-outline-primary" onclick="saveToIdeas()">Save to Ideas</button>
                <button type="button" class="btn btn-primary" onclick="createPost()">Create Post</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show navigation for logged in users
    showNavbar();
    
    // Set active nav link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.href.includes('/templates')) {
            link.classList.add('active');
        }
    });
    
    // Initialize category filtering
    initializeCategoryFiltering();
    
    // Show templates by default
    showSection('templates');
    
    // Load saved ideas
    loadIdeas();
});

function initializeCategoryFiltering() {
    const categoryBtns = document.querySelectorAll('.category-btn');
    const templateCards = document.querySelectorAll('.template-card');
    
    categoryBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Update active button
            categoryBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const category = this.dataset.category;
            
            // Filter templates
            templateCards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });
}

function showSection(section) {
    // Update sidebar active state
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Hide all sections
    document.getElementById('ideas-content').style.display = 'none';
    document.getElementById('templates-content').style.display = 'none';
    
    // Show selected section
    if (section === 'ideas') {
        document.getElementById('ideas-content').style.display = 'block';
        document.querySelector('.sidebar-item[onclick="showSection(\'ideas\')"]').classList.add('active');
    } else {
        document.getElementById('templates-content').style.display = 'block';
        document.querySelector('.sidebar-item[onclick="showSection(\'templates\')"]').classList.add('active');
    }
}

function addNewIdea(status) {
    const title = prompt('Enter idea title:');
    if (!title) return;
    
    const description = prompt('Enter idea description (optional):') || '';
    
    const idea = {
        id: Date.now(),
        title: title,
        description: description,
        status: status,
        timestamp: new Date().toISOString()
    };
    
    // Save to localStorage
    let ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    ideas.push(idea);
    localStorage.setItem('ideas', JSON.stringify(ideas));
    
    // Refresh the board
    loadIdeas();
}

function loadIdeas() {
    const ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    
    // Clear all columns
    document.querySelectorAll('.column-content').forEach(column => {
        const placeholder = column.querySelector('.add-idea-placeholder');
        column.innerHTML = '';
        column.appendChild(placeholder);
    });
    
    // Group ideas by status
    const groupedIdeas = {
        unassigned: [],
        todo: [],
        inprogress: [],
        done: []
    };
    
    ideas.forEach(idea => {
        if (groupedIdeas[idea.status]) {
            groupedIdeas[idea.status].push(idea);
        }
    });
    
    // Add ideas to columns
    Object.keys(groupedIdeas).forEach(status => {
        const column = document.querySelector(`[data-status="${status}"]`);
        if (column) {
            const placeholder = column.querySelector('.add-idea-placeholder');
            
            groupedIdeas[status].forEach(idea => {
                const ideaCard = createIdeaCard(idea);
                column.insertBefore(ideaCard, placeholder);
            });
            
            // Update count
            const countSpan = column.parentElement.querySelector('.count');
            if (countSpan) {
                countSpan.textContent = groupedIdeas[status].length;
            }
        }
    });
    
    // Initialize drag and drop for columns
    initializeDragAndDrop();
}

function initializeDragAndDrop() {
    const columns = document.querySelectorAll('.column-content');
    
    columns.forEach(column => {
        column.addEventListener('dragover', function(e) {
            e.preventDefault();
            column.style.backgroundColor = 'rgba(22, 142, 234, 0.1)';
        });
        
        column.addEventListener('dragleave', function(e) {
            if (!column.contains(e.relatedTarget)) {
                column.style.backgroundColor = '';
            }
        });
        
        column.addEventListener('drop', function(e) {
            e.preventDefault();
            column.style.backgroundColor = '';
            
            const ideaId = parseInt(e.dataTransfer.getData('text/plain'));
            const newStatus = column.dataset.status;
            
            // Update idea status
            let ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
            const idea = ideas.find(i => i.id === ideaId);
            
            if (idea && idea.status !== newStatus) {
                idea.status = newStatus;
                localStorage.setItem('ideas', JSON.stringify(ideas));
                loadIdeas(); // Reload to update the display
            }
        });
    });
}

function createIdeaCard(idea) {
    const card = document.createElement('div');
    card.className = 'idea-card';
    card.draggable = true;
    card.dataset.ideaId = idea.id;
    
    card.innerHTML = `
        <h6>${idea.title}</h6>
        ${idea.description ? `<p>${idea.description}</p>` : ''}
        <div class="idea-actions">
            <button class="btn btn-sm btn-outline-primary" onclick="editIdea(${idea.id})">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteIdea(${idea.id})">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    // Add drag event listeners
    card.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('text/plain', idea.id);
        card.style.opacity = '0.5';
    });
    
    card.addEventListener('dragend', function(e) {
        card.style.opacity = '1';
    });
    
    return card;
}

function editIdea(ideaId) {
    const ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    const idea = ideas.find(i => i.id === ideaId);
    if (!idea) return;
    
    const newTitle = prompt('Edit title:', idea.title);
    if (newTitle === null) return;
    
    const newDescription = prompt('Edit description:', idea.description || '');
    if (newDescription === null) return;
    
    idea.title = newTitle;
    idea.description = newDescription;
    
    localStorage.setItem('ideas', JSON.stringify(ideas));
    loadIdeas();
}

function deleteIdea(ideaId) {
    if (!confirm('Delete this idea?')) return;
    
    let ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    ideas = ideas.filter(i => i.id !== ideaId);
    
    localStorage.setItem('ideas', JSON.stringify(ideas));
    loadIdeas();
}

function useTemplate(button) {
    const card = button.closest('.template-card');
    const title = card.querySelector('h4').textContent;
    const description = card.querySelector('p').textContent;
    
    // Add template as an idea
    const idea = {
        id: Date.now(),
        title: title,
        description: description,
        status: 'unassigned',
        timestamp: new Date().toISOString()
    };
    
    let ideas = JSON.parse(localStorage.getItem('ideas') || '[]');
    ideas.push(idea);
    localStorage.setItem('ideas', JSON.stringify(ideas));
    
    // Switch to ideas view
    showSection('ideas');
    loadIdeas();
    
    alert('Template added to Ideas!');
}

function saveToIdeas() {
    const content = document.getElementById('templateContent').value;
    const title = document.getElementById('templateTitle').textContent;
    
    // Save to localStorage for ideas page
    let ideas = JSON.parse(localStorage.getItem('savedIdeas') || '[]');
    ideas.push({
        id: Date.now(),
        title: title,
        content: content,
        status: 'unassigned',
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('savedIdeas', JSON.stringify(ideas));
    
    // Show success message
    alert('Template saved to Ideas!');
    
    // Close modal
    bootstrap.Modal.getInstance(document.getElementById('templateModal')).hide();
}

function createPost() {
    const content = document.getElementById('templateContent').value;
    const title = document.getElementById('templateTitle').textContent;
    
    // For now, redirect to upload page with pre-filled content
    localStorage.setItem('prefilledContent', JSON.stringify({
        title: title,
        description: content
    }));
    
    // Close modal and redirect
    bootstrap.Modal.getInstance(document.getElementById('templateModal')).hide();
    window.location.href = '/upload';
}
</script>
{% endblock %}
