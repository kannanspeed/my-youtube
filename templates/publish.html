{% extends "base.html" %}

{% block content %}
<div id="mainContent">
    <div class="container-fluid px-4">
        <!-- Header Section with All Channels and Action Buttons -->
        <div class="publish-header-section">
            <div class="row align-items-center mb-4">
                <div class="col-md-6">
                    <h1 class="page-title mb-0">All Channels</h1>
                </div>
                <div class="col-md-6">
                    <div class="header-actions d-flex justify-content-end gap-2">
                        <button class="btn btn-outline-secondary">
                            <i class="fas fa-share me-2"></i>Share Feedback
                        </button>
                        <button class="btn btn-outline-secondary">
                            <i class="fas fa-list me-2"></i>List
                        </button>
                        <button class="btn btn-outline-secondary">
                            <i class="fas fa-calendar me-2"></i>Calendar
                        </button>
                        <button class="btn btn-primary" onclick="showCreateModal()">
                            <i class="fas fa-plus me-2"></i>New Post
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Section -->
        <div class="publish-tabs-section mb-4">
            <div class="tabs-container">
                <button class="tab-btn active" data-tab="queue">
                    Queue <span class="badge">0</span>
                </button>
                <button class="tab-btn" data-tab="drafts">
                    Drafts <span class="badge">0</span>
                </button>
                <button class="tab-btn" data-tab="approvals">
                    Approvals <span class="badge">0</span>
                </button>
                <button class="tab-btn" data-tab="sent">
                    Sent <span class="badge">68</span>
                </button>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="tab-content">
            <!-- Queue Tab -->
            <div class="tab-pane active" id="queue-tab">
                <div class="empty-state text-center py-5">
                    <div class="empty-icon mb-3">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h3 class="mb-3">No posts scheduled</h3>
                    <p class="text-muted mb-4">Schedule some posts and they will appear here</p>
                    <button class="btn btn-primary" onclick="showCreateModal()">
                        <i class="fas fa-plus me-2"></i>New Post
                    </button>
                </div>
            </div>
            
            <!-- Other tabs content (hidden by default) -->
            <div class="tab-pane" id="drafts-tab">
                <div class="empty-state text-center py-5">
                    <div class="empty-icon mb-3">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3 class="mb-3">No drafts</h3>
                    <p class="text-muted mb-4">Your draft posts will appear here</p>
                </div>
            </div>
            
            <div class="tab-pane" id="approvals-tab">
                <div class="empty-state text-center py-5">
                    <div class="empty-icon mb-3">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="mb-3">No posts awaiting approval</h3>
                    <p class="text-muted mb-4">Posts pending approval will appear here</p>
                </div>
            </div>
            
            <div class="tab-pane" id="sent-tab">
                <div class="upload-history">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>Upload History</h4>
                        <button class="btn btn-sm btn-outline-secondary" onclick="clearHistory()">
                            <i class="fas fa-trash"></i> Clear History
                        </button>
                    </div>
                    <div id="historyContainer">
                        <!-- History will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show navigation for logged in users
    showNavbar();
    
    // Set active nav link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.href.includes('/publish')) {
            link.classList.add('active');
        }
    });
    
    // Initialize tab functionality
    initializeTabs();
    
    // Load upload history
    loadUploadHistoryDisplay();
});

function initializeTabs() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            // Update active button
            tabBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Update active tab pane
            tabPanes.forEach(pane => pane.classList.remove('active'));
            document.getElementById(tabId + '-tab').classList.add('active');
            
            // Load history when sent tab is clicked
            if (tabId === 'sent') {
                loadUploadHistoryDisplay();
            }
        });
    });
}

function loadUploadHistoryDisplay() {
    const history = JSON.parse(localStorage.getItem('uploadHistory') || '[]');
    const container = document.getElementById('historyContainer');
    
    if (!container) return;
    
    if (history.length === 0) {
        container.innerHTML = `
            <div class="empty-state text-center py-5">
                <div class="empty-icon mb-3">
                    <i class="fas fa-history"></i>
                </div>
                <h5 class="mb-3">No upload history</h5>
                <p class="text-muted">Your uploaded videos will appear here</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = history.map(item => createHistoryItem(item)).join('');
}

function createHistoryItem(item) {
    const date = new Date(item.timestamp).toLocaleDateString();
    const time = new Date(item.timestamp).toLocaleTimeString();
    
    let statusBadge = '';
    let statusIcon = '';
    let actionButtons = '';
    
    switch(item.status) {
        case 'uploaded':
            statusBadge = '<span class="badge bg-success">Uploaded</span>';
            statusIcon = '<i class="fas fa-check-circle text-success"></i>';
            if (item.videoUrl) {
                actionButtons = `<a href="${item.videoUrl}" target="_blank" class="btn btn-sm btn-outline-primary">
                    <i class="fab fa-youtube"></i> View on YouTube
                </a>`;
            }
            break;
        case 'scheduled':
            statusBadge = '<span class="badge bg-warning">Scheduled</span>';
            statusIcon = '<i class="fas fa-clock text-warning"></i>';
            break;
        case 'failed':
            statusBadge = '<span class="badge bg-danger">Failed</span>';
            statusIcon = '<i class="fas fa-exclamation-circle text-danger"></i>';
            break;
        default:
            statusBadge = '<span class="badge bg-secondary">Unknown</span>';
            statusIcon = '<i class="fas fa-question-circle text-secondary"></i>';
    }
    
    return `
        <div class="card mb-3">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-1">
                        ${statusIcon}
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-1">${item.title}</h6>
                        <small class="text-muted">${date} at ${time}</small>
                        ${item.error ? `<div class="text-danger small mt-1">Error: ${item.error}</div>` : ''}
                    </div>
                    <div class="col-md-3">
                        ${statusBadge}
                        ${item.videoId ? `<div class="small text-muted mt-1">ID: ${item.videoId}</div>` : ''}
                    </div>
                    <div class="col-md-2 text-end">
                        ${actionButtons}
                    </div>
                </div>
            </div>
        </div>
    `;
}

function clearHistory() {
    if (confirm('Are you sure you want to clear all upload history? This action cannot be undone.')) {
        localStorage.removeItem('uploadHistory');
        loadUploadHistoryDisplay();
    }
}
</script>
{% endblock %}
